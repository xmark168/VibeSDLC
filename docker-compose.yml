services:
  # Management Service
  management-service:
    build:
      context: ./services/management-service
      dockerfile: Dockerfile
    container_name: management-service
    environment:
      - POSTGRES_SERVER=${POSTGRES_SERVER:-localhost}
      - POSTGRES_PORT=${POSTGRES_PORT:-5432}
      - POSTGRES_DB=${POSTGRES_DB:-app}
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-changethis}
      - KAFKA_BOOTSTRAP_SERVERS=${KAFKA_BOOTSTRAP_SERVERS:-localhost:9092}
      - SECRET_KEY=${SECRET_KEY:-changethis}
      - FIRST_SUPERUSER=${FIRST_SUPERUSER:-admin@example.com}
      - FIRST_SUPERUSER_PASSWORD=${FIRST_SUPERUSER_PASSWORD:-changethis}
    ports:
      - "8000:8000"
    volumes:
      - ./services/management-service:/app

  # AI Agent Service
  ai-agent-service:
    build:
      context: ./services/ai-agent-service
      dockerfile: Dockerfile
    container_name: ai-agent-service
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=${KAFKA_BOOTSTRAP_SERVERS:-localhost:9092}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - LANGFUSE_SECRET_KEY=${LANGFUSE_SECRET_KEY}
      - LANGFUSE_PUBLIC_KEY=${LANGFUSE_PUBLIC_KEY}
      - LANGFUSE_HOST=${LANGFUSE_HOST}
    ports:
      - "8001:8001"
    volumes:
      - ./services/ai-agent-service:/app

  # Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: frontend
    environment:
      - VITE_API_URL=${VITE_API_URL:-http://localhost:8000/api/v1}
      - VITE_AGENT_API_URL=${VITE_AGENT_API_URL:-http://localhost:8001/api/v1}
    ports:
      - "5173:5173"
    volumes:
      - ./frontend:/app
      - /app/node_modules