{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ProductBacklog",
  "description": "Template định nghĩa cấu trúc của Product Backlog với flat list chứa tất cả backlog items (Epic, User Story, Task, Sub-task). Mỗi item có type và parent_id để thể hiện hierarchy theo Jira: Epic → User Story/Task (cùng cấp) → Sub-task.",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Thông tin metadata về backlog.",
      "properties": {
        "product_name": {
          "type": "string",
          "description": "Tên sản phẩm.",
          "minLength": 3,
          "maxLength": 100
        },
        "version": {
          "type": "string",
          "description": "Phiên bản backlog, ví dụ: 'v1.0', 'v2.1'.",
          "default": "v1.0"
        },
        "total_items": {
          "type": "integer",
          "description": "Tổng số backlog items.",
          "minimum": 0
        },
        "total_story_points": {
          "type": "number",
          "description": "Tổng story points (tính từ user stories).",
          "minimum": 0
        },
        "total_estimate_hours": {
          "type": "number",
          "description": "Tổng estimate hours (tính từ sub-tasks).",
          "minimum": 0
        },
        "total_epics": {
          "type": "integer",
          "description": "Tổng số Epics.",
          "minimum": 0
        },
        "total_user_stories": {
          "type": "integer",
          "description": "Tổng số User Stories.",
          "minimum": 0
        },
        "total_tasks": {
          "type": "integer",
          "description": "Tổng số Tasks.",
          "minimum": 0
        },
        "total_subtasks": {
          "type": "integer",
          "description": "Tổng số Sub-tasks.",
          "minimum": 0
        }
      },
      "required": ["product_name", "version", "total_items"],
      "additionalProperties": false
    },
    "items": {
      "type": "array",
      "description": "Danh sách tất cả backlog items (Epic, User Story, Task, Sub-task) trong một flat list. Hierarchy được thể hiện qua parent_id.",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "ID duy nhất của item. Format: EPIC-001, US-001, TASK-001, SUB-001 (CHỮ HOA, số 3 chữ số).",
            "pattern": "^(EPIC|US|TASK|SUB)-\\d{3}$"
          },
          "type": {
            "type": "string",
            "description": "Loại backlog item.",
            "enum": ["Epic", "User Story", "Task", "Sub-task"]
          },
          "parent_id": {
            "type": ["string", "null"],
            "description": "ID của item cha. Epic: null. User Story/Task: EPIC-xxx. Sub-task: US-xxx hoặc TASK-xxx.",
            "pattern": "^(EPIC|US|TASK|SUB)-\\d{3}$"
          },
          "title": {
            "type": "string",
            "description": "Tiêu đề của item. User Story PHẢI theo format: 'As a [user], I want to [action] so that [benefit]'.",
            "minLength": 10,
            "maxLength": 200
          },
          "description": {
            "type": "string",
            "description": "Mô tả chi tiết về item.",
            "minLength": 20,
            "maxLength": 1000
          },
          "rank": {
            "type": ["integer", "null"],
            "description": "Thứ tự ưu tiên (1 = cao nhất). Sẽ được fill bởi Priority Agent. Default: null.",
            "minimum": 1,
            "default": null
          },
          "status": {
            "type": "string",
            "description": "Trạng thái hiện tại của item.",
            "enum": ["Backlog", "Ready", "In Progress", "Done"],
            "default": "Backlog"
          },
          "story_point": {
            "type": ["integer", "null"],
            "description": "Story points - CHỈ cho User Story. Fibonacci: 1, 2, 3, 5, 8, 13, 21. Epic/Task/Sub-task để null.",
            "enum": [1, 2, 3, 5, 8, 13, 21, null]
          },
          "estimate_value": {
            "type": ["number", "null"],
            "description": "Ước lượng số giờ - CHỈ cho Sub-task. Epic/User Story/Task để null.",
            "minimum": 0.5,
            "maximum": 200
          },
          "acceptance_criteria": {
            "type": "array",
            "description": "Tiêu chí chấp nhận (cho User Story và Task). Format: Given-When-Then hoặc checklist rõ ràng.",
            "items": {
              "type": "string",
              "minLength": 15,
              "maxLength": 300
            },
            "minItems": 1,
            "maxItems": 10
          },
          "dependencies": {
            "type": "array",
            "description": "Danh sách IDs của items phụ thuộc (phải hoàn thành trước).",
            "items": {
              "type": "string",
              "pattern": "^(EPIC|US|TASK|SUB)-\\d{3}$"
            },
            "default": []
          },
          "labels": {
            "type": "array",
            "description": "Labels phân loại business domain: authentication, payment, notification, etc. KHÔNG dùng tech stack.",
            "items": {
              "type": "string",
              "minLength": 3,
              "maxLength": 30
            },
            "default": []
          },
          "task_type": {
            "type": ["string", "null"],
            "description": "Loại task - CHỈ cho type='Task' hoặc 'Sub-task'. Để null với Epic/User Story.",
            "enum": ["Development", "Testing", "Documentation", "Research", "Infrastructure", null]
          },
          "business_value": {
            "type": ["string", "null"],
            "description": "Giá trị kinh doanh (cho Epic và User Story). Null cho Task/Sub-task.",
            "maxLength": 500
          }
        },
        "required": ["id", "type", "title", "description", "status"],
        "additionalProperties": false
      },
      "minItems": 1,
      "maxItems": 300
    }
  },
  "required": ["metadata", "items"],
  "additionalProperties": false
}
