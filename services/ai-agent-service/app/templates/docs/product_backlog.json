{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ProductBacklog",
  "description": "Template định nghĩa cấu trúc của Product Backlog với flat list chứa tất cả backlog items (Epic, User Story, Task, Sub-task). Mỗi item có type và parent_id để thể hiện hierarchy.",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "description": "Thông tin metadata về backlog.",
      "properties": {
        "product_name": {
          "type": "string",
          "description": "Tên sản phẩm.",
          "minLength": 3,
          "maxLength": 100
        },
        "version": {
          "type": "string",
          "description": "Phiên bản backlog, ví dụ: 'v1.0', 'v2.1'.",
          "default": "v1.0"
        },
        "total_items": {
          "type": "integer",
          "description": "Tổng số backlog items.",
          "minimum": 0
        },
        "total_story_points": {
          "type": "number",
          "description": "Tổng story points (tính từ user stories).",
          "minimum": 0
        }
      },
      "required": ["product_name", "version", "total_items"],
      "additionalProperties": false
    },
    "items": {
      "type": "array",
      "description": "Danh sách tất cả backlog items (Epic, User Story, Task) trong một flat list. Hierarchy được thể hiện qua parent_id.",
      "items": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "ID duy nhất của item. Format: EPIC-001, US-001, TASK-001 (CHỮ HOA, số 3 chữ số).",
            "pattern": "^(EPIC|US|TASK)-\\d{3}$"
          },
          "type": {
            "type": "string",
            "description": "Loại backlog item.",
            "enum": ["Epic", "User Story", "Task"]
          },
          "parent_id": {
            "type": ["string", "null"],
            "description": "ID của item cha. Epic: null. User Story: EPIC-xxx hoặc null. Task: US-xxx.",
            "pattern": "^(EPIC|US|TASK)-\\d{3}$"
          },
          "title": {
            "type": "string",
            "description": "Tiêu đề của item. User Story PHẢI theo format: 'As a [user], I want to [action] so that [benefit]'.",
            "minLength": 10,
            "maxLength": 200
          },
          "description": {
            "type": "string",
            "description": "Mô tả chi tiết về item.",
            "minLength": 20,
            "maxLength": 1000
          },
          "priority": {
            "type": "string",
            "description": "Mức độ ưu tiên (sẽ được set bởi Priority Agent). Default: 'Not Set'.",
            "enum": ["High", "Medium", "Low", "Not Set"],
            "default": "Not Set"
          },
          "status": {
            "type": "string",
            "description": "Trạng thái hiện tại của item.",
            "enum": ["Backlog", "Ready", "In Progress", "Done"],
            "default": "Backlog"
          },
          "story_points": {
            "type": ["integer", "null"],
            "description": "Story points - CHỈ cho User Story. Fibonacci: 1, 2, 3, 5, 8, 13, 21. Epic/Task để null.",
            "enum": [1, 2, 3, 5, 8, 13, 21, null]
          },
          "estimated_hours": {
            "type": ["number", "null"],
            "description": "Ước lượng số giờ - CHỈ cho Task. Epic/User Story để null.",
            "minimum": 0.5,
            "maximum": 200
          },
          "acceptance_criteria": {
            "type": "array",
            "description": "Tiêu chí chấp nhận (cho User Story và Task). Format: Given-When-Then hoặc checklist rõ ràng.",
            "items": {
              "type": "string",
              "minLength": 15,
              "maxLength": 300
            },
            "minItems": 1,
            "maxItems": 10
          },
          "dependencies": {
            "type": "array",
            "description": "Danh sách IDs của items phụ thuộc (phải hoàn thành trước).",
            "items": {
              "type": "string",
              "pattern": "^(EPIC|US|TASK)-\\d{3}$"
            },
            "default": []
          },
          "labels": {
            "type": "array",
            "description": "Labels phân loại business domain: authentication, payment, notification, etc. KHÔNG dùng tech stack.",
            "items": {
              "type": "string",
              "minLength": 3,
              "maxLength": 30
            },
            "default": []
          },
          "task_type": {
            "type": ["string", "null"],
            "description": "Loại task - CHỈ cho type='Task'. Để null với Epic/User Story.",
            "enum": ["Feature Development", "Bug Fix", "Testing", "Documentation", "Performance", "Security", null]
          },
          "business_value": {
            "type": "string",
            "description": "Giá trị kinh doanh (cho Epic và User Story). Mô tả impact với users/business.",
            "maxLength": 500
          },
          "wsjf_inputs": {
            "type": "object",
            "description": "WSJF inputs để tính priority (sẽ được fill bởi Priority Agent). Để empty object nếu chưa có.",
            "properties": {
              "business_value": {
                "type": "integer",
                "description": "Giá trị kinh doanh (1-10)",
                "minimum": 1,
                "maximum": 10
              },
              "time_criticality": {
                "type": "integer",
                "description": "Độ cấp thiết về thời gian (1-10)",
                "minimum": 1,
                "maximum": 10
              },
              "risk_reduction": {
                "type": "integer",
                "description": "Giảm rủi ro (1-10)",
                "minimum": 1,
                "maximum": 10
              },
              "job_size": {
                "type": "integer",
                "description": "Kích thước công việc (1-13, Fibonacci)",
                "enum": [1, 2, 3, 5, 8, 13]
              }
            },
            "default": {}
          }
        },
        "required": ["id", "type", "title", "description", "status"],
        "additionalProperties": false
      },
      "minItems": 1,
      "maxItems": 300
    }
  },
  "required": ["metadata", "items"],
  "additionalProperties": false
}
