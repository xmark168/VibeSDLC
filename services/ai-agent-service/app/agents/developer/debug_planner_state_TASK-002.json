{
    "success": true,
    "final_plan": {
        "task_id": "TSK-0785",
        "description": "Task: Implement user login functionality\nTask Description: Create user login API endpoint with authe...",
        "complexity_score": 7,
        "plan_type": "complex",
        "functional_requirements": [
            "Create a POST /api/auth/login endpoint that accepts email and password.",
            "Validate user credentials against the database.",
            "Compare the hashed password using bcrypt.",
            "Return a JWT token containing user ID, email, and expiration time upon successful login.",
            "Implement rate limiting to prevent brute force attacks.",
            "Log failed login attempts for security monitoring.",
            "Return appropriate error messages for invalid credentials.",
            "Include comprehensive unit tests for various authentication scenarios.",
            "Update API documentation with details of the /api/auth/login endpoint."
        ],
        "steps": [
            {
                "step": 1,
                "title": "Setup authentication foundation",
                "description": "Install necessary libraries and configure environment for authentication.",
                "category": "backend",
                "sub_steps": [
                    {
                        "sub_step": "1.1",
                        "title": "Install jsonwebtoken and bcrypt libraries",
                        "description": "Add JWT and password hashing libraries to package.json",
                        "action_type": "setup",
                        "files_affected": [
                            "package.json"
                        ],
                        "test": "Run npm install and verify jsonwebtoken and bcrypt are installed correctly"
                    },
                    {
                        "sub_step": "1.2",
                        "title": "Create JWT utility functions",
                        "description": "Implement signToken() and verifyToken() helper functions",
                        "action_type": "create",
                        "files_affected": [
                            "src/utils/jwt.js"
                        ],
                        "test": "Import and call signToken() with test payload, verify it returns valid JWT string"
                    },
                    {
                        "sub_step": "1.3",
                        "title": "Add JWT_SECRET to environment config",
                        "description": "Add JWT_SECRET variable to .env and config loader",
                        "action_type": "modify",
                        "files_affected": [
                            ".env.example",
                            "src/config/index.js"
                        ],
                        "test": "Start application and verify JWT_SECRET is loaded correctly from environment"
                    }
                ],
                "dependencies": [],
                "estimated_hours": 0.0,
                "complexity": "medium"
            },
            {
                "step": 2,
                "title": "Implement login API endpoint",
                "description": "Create authentication endpoint with credential validation.",
                "category": "backend",
                "sub_steps": [
                    {
                        "sub_step": "2.1",
                        "title": "Create auth router and login route",
                        "description": "Setup POST /api/auth/login route with Express router",
                        "action_type": "modify",
                        "files_affected": [
                            "src/routes/auth.js"
                        ],
                        "test": "Send POST request to /api/auth/login and verify route is accessible (404 → 400/500)"
                    },
                    {
                        "sub_step": "2.2",
                        "title": "Implement login controller logic",
                        "description": "Create controller to validate credentials and generate JWT",
                        "action_type": "modify",
                        "files_affected": [
                            "src/controllers/authController.js"
                        ],
                        "test": "Call login controller with test credentials and verify JWT token is generated"
                    },
                    {
                        "sub_step": "2.3",
                        "title": "Add request validation middleware",
                        "description": "Validate email format and password presence",
                        "action_type": "create",
                        "files_affected": [
                            "src/middleware/validation.js"
                        ],
                        "test": "Send invalid request (missing email/password) and verify 400 validation error"
                    },
                    {
                        "sub_step": "2.4",
                        "title": "Implement bcrypt password comparison",
                        "description": "Add logic to compare hashed password during login",
                        "action_type": "modify",
                        "files_affected": [
                            "src/services/authService.js"
                        ],
                        "test": "Test login with valid and invalid passwords to ensure correct behavior"
                    },
                    {
                        "sub_step": "2.5",
                        "title": "Implement JWT generation in login",
                        "description": "Generate JWT token upon successful login",
                        "action_type": "modify",
                        "files_affected": [
                            "src/services/authService.js"
                        ],
                        "test": "Verify JWT token contains user ID and email after successful login"
                    },
                    {
                        "sub_step": "2.6",
                        "title": "Implement rate limiting middleware",
                        "description": "Add rate limiting to prevent brute force attacks",
                        "action_type": "create",
                        "files_affected": [
                            "src/middleware/rateLimiter.js"
                        ],
                        "test": "Send multiple requests to /api/auth/login and verify rate limit response"
                    },
                    {
                        "sub_step": "2.7",
                        "title": "Log failed login attempts",
                        "description": "Implement logging for failed login attempts",
                        "action_type": "create",
                        "files_affected": [
                            "src/logs/failedLoginLogger.js"
                        ],
                        "test": "Trigger failed login and verify log entry is created"
                    }
                ],
                "dependencies": [],
                "estimated_hours": 0.0,
                "complexity": "medium"
            },
            {
                "step": 3,
                "title": "Testing and documentation",
                "description": "Create unit tests for authentication scenarios and update API documentation.",
                "category": "backend",
                "sub_steps": [
                    {
                        "sub_step": "3.1",
                        "title": "Write unit tests for login functionality",
                        "description": "Create tests for various authentication scenarios",
                        "action_type": "create",
                        "files_affected": [
                            "src/tests/auth/login.test.js"
                        ],
                        "test": "Run tests and verify all authentication scenarios pass"
                    },
                    {
                        "sub_step": "3.2",
                        "title": "Update API documentation",
                        "description": "Document /api/auth/login endpoint with request and response details",
                        "action_type": "modify",
                        "files_affected": [
                            "src/docs/apiDocumentation.md"
                        ],
                        "test": "Verify documentation reflects the latest changes for /api/auth/login"
                    }
                ],
                "dependencies": [],
                "estimated_hours": 0.0,
                "complexity": "medium"
            }
        ],
        "database_changes": [],
        "external_dependencies": [
            {
                "package": "jsonwebtoken",
                "version": "^9.0.0",
                "purpose": "JWT token generation"
            },
            {
                "package": "bcrypt",
                "version": "^5.1.0",
                "purpose": "Password hashing"
            },
            {
                "package": "express-rate-limit",
                "version": "^6.0.0",
                "purpose": "Rate limiting middleware"
            }
        ],
        "internal_dependencies": [
            {
                "module": "User model",
                "required_by_step": 2
            },
            {
                "module": "Validation middleware",
                "required_by_step": 2
            }
        ],
        "total_estimated_hours": 5.5,
        "story_points": 8,
        "execution_order": [
            "Execute steps sequentially: 1 → 2 → 3",
            "Within each step, execute sub-steps in order",
            "Test after each sub-step before proceeding",
            "Commit code after each completed sub-step"
        ]
    },
    "ready_for_implementation": true,
    "task_id": "TSK-0785",
    "complexity_score": 7,
    "estimated_hours": 5.5,
    "story_points": 8,
    "validation_score": 1.0,
    "status": "finalized",
    "iterations": 0,
    "metadata": {
        "planner_version": "1.0",
        "total_steps": 9,
        "thread_id": "test_session_planner_TASK-002"
    }
}