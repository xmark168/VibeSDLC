{
    "success": true,
    "final_plan": {
        "task_id": "TSK-4126",
        "description": "Task: Implement user login functionality\nTask Description: Create user login API endpoint with authe...",
        "complexity_score": 7,
        "plan_type": "complex",
        "functional_requirements": [
            "Create a POST /api/auth/login API endpoint that accepts email and password.",
            "Validate user credentials against the database.",
            "Compare the hashed password using bcrypt.",
            "Return a JWT token containing user ID, email, and expiration time upon successful login.",
            "Implement rate limiting to prevent brute force attacks.",
            "Log failed login attempts for security monitoring.",
            "Return appropriate error messages for invalid credentials.",
            "Include comprehensive unit tests for all authentication scenarios.",
            "Update API documentation with details of the /api/auth/login endpoint."
        ],
        "steps": [
            {
                "step": 1,
                "title": "Setup JWT authentication foundation",
                "description": "Install dependencies and configure JWT infrastructure",
                "category": "backend",
                "sub_steps": [
                    {
                        "sub_step": "1.1",
                        "title": "Install jsonwebtoken and bcrypt libraries",
                        "description": "Add JWT and password hashing libraries to package.json",
                        "action_type": "setup",
                        "files_affected": [
                            "package.json"
                        ],
                        "test": "Run npm install and verify jsonwebtoken and bcrypt are installed correctly"
                    },
                    {
                        "sub_step": "1.2",
                        "title": "Create JWT utility functions",
                        "description": "Implement signToken() and verifyToken() helper functions",
                        "action_type": "create",
                        "files_affected": [
                            "src/utils/jwt.js"
                        ],
                        "test": "Import and call signToken() with test payload, verify it returns valid JWT string"
                    },
                    {
                        "sub_step": "1.3",
                        "title": "Add JWT_SECRET to environment config",
                        "description": "Add JWT_SECRET variable to .env and config loader",
                        "action_type": "modify",
                        "files_affected": [
                            ".env.example",
                            "src/config/environment.js"
                        ],
                        "test": "Start application and verify JWT_SECRET is loaded correctly from environment"
                    }
                ],
                "dependencies": [],
                "estimated_hours": 0.0,
                "complexity": "medium"
            },
            {
                "step": 2,
                "title": "Implement login API endpoint",
                "description": "Create authentication endpoint with credential validation",
                "category": "backend",
                "sub_steps": [
                    {
                        "sub_step": "2.1",
                        "title": "Create auth router and login route",
                        "description": "Setup POST /api/auth/login route with Express router",
                        "action_type": "create",
                        "files_affected": [
                            "src/routes/authRoutes.js"
                        ],
                        "test": "Send POST request to /api/auth/login and verify route is accessible (404 → 400/500)"
                    },
                    {
                        "sub_step": "2.2",
                        "title": "Implement login controller logic",
                        "description": "Create controller to validate credentials and generate JWT",
                        "action_type": "create",
                        "files_affected": [
                            "src/controllers/authController.js"
                        ],
                        "test": "Call login controller with test credentials and verify JWT token is generated"
                    },
                    {
                        "sub_step": "2.3",
                        "title": "Add request validation middleware",
                        "description": "Validate email format and password presence",
                        "action_type": "create",
                        "files_affected": [
                            "src/middleware/validation.js"
                        ],
                        "test": "Send invalid request (missing email/password) and verify 400 validation error"
                    },
                    {
                        "sub_step": "2.4",
                        "title": "Implement bcrypt password comparison",
                        "description": "Add logic to compare hashed passwords using bcrypt",
                        "action_type": "modify",
                        "files_affected": [
                            "src/controllers/authController.js"
                        ],
                        "test": "Call login controller with valid email and invalid password, verify it fails authentication"
                    },
                    {
                        "sub_step": "2.5",
                        "title": "Implement rate limiting middleware",
                        "description": "Add rate limiting to prevent brute force attacks",
                        "action_type": "create",
                        "files_affected": [
                            "src/middleware/rateLimitMiddleware.js"
                        ],
                        "test": "Send multiple requests in a short time frame and verify rate limit response"
                    },
                    {
                        "sub_step": "2.6",
                        "title": "Log failed login attempts",
                        "description": "Implement logging for failed login attempts for security monitoring",
                        "action_type": "modify",
                        "files_affected": [
                            "src/controllers/authController.js"
                        ],
                        "test": "Attempt to login with invalid credentials and verify log entry is created"
                    }
                ],
                "dependencies": [],
                "estimated_hours": 0.0,
                "complexity": "medium"
            },
            {
                "step": 3,
                "title": "Create unit tests for login functionality",
                "description": "Write unit tests for all authentication scenarios",
                "category": "testing",
                "sub_steps": [
                    {
                        "sub_step": "3.1",
                        "title": "Test successful login",
                        "description": "Verify successful login returns JWT token and user data",
                        "action_type": "test",
                        "files_affected": [
                            "src/tests/auth.test.js"
                        ],
                        "test": "Run unit tests and verify successful login returns expected results"
                    },
                    {
                        "sub_step": "3.2",
                        "title": "Test invalid credentials",
                        "description": "Verify handling of invalid email or password",
                        "action_type": "test",
                        "files_affected": [
                            "src/tests/auth.test.js"
                        ],
                        "test": "Run unit tests and verify appropriate error messages for invalid credentials"
                    },
                    {
                        "sub_step": "3.3",
                        "title": "Test rate limiting behavior",
                        "description": "Verify that rate limiting blocks further login attempts after threshold",
                        "action_type": "test",
                        "files_affected": [
                            "src/tests/auth.test.js"
                        ],
                        "test": "Run unit tests and verify rate limiting response after multiple failed attempts"
                    }
                ],
                "dependencies": [],
                "estimated_hours": 0.0,
                "complexity": "medium"
            },
            {
                "step": 4,
                "title": "Update API documentation",
                "description": "Document the /api/auth/login endpoint and its usage",
                "category": "documentation",
                "sub_steps": [
                    {
                        "sub_step": "4.1",
                        "title": "Add endpoint details to API documentation",
                        "description": "Include details of the /api/auth/login endpoint in the API docs",
                        "action_type": "modify",
                        "files_affected": [
                            "docs/api.md"
                        ],
                        "test": "Review API documentation and verify /api/auth/login endpoint is documented correctly"
                    }
                ],
                "dependencies": [],
                "estimated_hours": 0.0,
                "complexity": "medium"
            }
        ],
        "database_changes": [
            {
                "change": "Add users collection",
                "fields": [
                    "_id",
                    "email",
                    "password_hash",
                    "created_at",
                    "updated_at"
                ],
                "affected_step": 1
            }
        ],
        "external_dependencies": [
            {
                "package": "jsonwebtoken",
                "version": "^9.0.0",
                "purpose": "JWT token generation"
            },
            {
                "package": "bcrypt",
                "version": "^5.1.0",
                "purpose": "Password hashing"
            },
            {
                "package": "express-rate-limit",
                "version": "^5.3.0",
                "purpose": "Rate limiting middleware"
            }
        ],
        "internal_dependencies": [
            {
                "module": "User model",
                "required_by_step": 2
            },
            {
                "module": "Validation middleware",
                "required_by_step": 2
            }
        ],
        "total_estimated_hours": 6.5,
        "story_points": 8,
        "execution_order": [
            "Execute steps sequentially: 1 → 2 → 3 → 4",
            "Within each step, execute sub-steps in order",
            "Test after each sub-step before proceeding",
            "Commit code after each completed sub-step"
        ]
    },
    "ready_for_implementation": true,
    "task_id": "TSK-4126",
    "complexity_score": 7,
    "estimated_hours": 6.5,
    "story_points": 8,
    "validation_score": 0.9,
    "status": "finalized",
    "iterations": 3,
    "metadata": {
        "planner_version": "1.0",
        "total_steps": 17,
        "thread_id": "test_session_planner_TASK-002"
    }
}