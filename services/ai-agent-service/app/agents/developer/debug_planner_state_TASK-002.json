{
    "success": true,
    "final_plan": {
        "task_info": {
            "task_id": "TSK-2796",
            "description": "Task: Implement user login functionality\nTask Description: Create user login API endpoint with authe...",
            "complexity_score": 6,
            "plan_type": "complex"
        },
        "requirements": {
            "functional_requirements": [
                "Create a user login API endpoint at /api/auth/login that accepts email and password.",
                "Validate user credentials against the database.",
                "Compare the hashed password using bcrypt for authentication.",
                "Return a JWT token containing user ID, email, and expiration time upon successful login.",
                "Implement rate limiting to prevent brute force attacks.",
                "Log failed login attempts for security monitoring.",
                "Return appropriate error messages for invalid credentials.",
                "Include comprehensive unit tests for various authentication scenarios.",
                "Update API documentation with details of the /api/auth/login endpoint."
            ],
            "acceptance_criteria": [
                "Given a valid email and password, when a POST request is made to /api/auth/login, then a JWT token is returned with user information.",
                "Given an invalid email or password, when a POST request is made to /api/auth/login, then an appropriate error message is returned.",
                "Given multiple failed login attempts, when the rate limit is reached, then further login attempts are rejected with a rate limit error."
            ],
            "business_rules": {
                "UserCredentialValidation": "User credentials must be validated against the database, ensuring that the email exists and the password matches the hashed version stored."
            },
            "technical_specs": {
                "framework": "Node.js with Express framework for API development.",
                "database": "MongoDB for storing user credentials.",
                "apis": [
                    "bcrypt for password hashing",
                    "jsonwebtoken for generating JWT tokens"
                ]
            },
            "constraints": [
                "Must maintain backward compatibility",
                "Must follow existing code style and patterns",
                "Must include appropriate error handling"
            ]
        },
        "implementation": {
            "approach": {
                "strategy": "Develop a user login API endpoint that validates credentials and generates a JWT token.",
                "pattern": "Follow existing service and route patterns in the codebase.",
                "architecture_alignment": "Aligns with the current Express architecture and service-oriented design."
            },
            "steps": [
                {
                    "step": 1,
                    "title": "Update User Model",
                    "description": "Ensure the user model has necessary fields for email and hashed password.",
                    "action": "Modify the user model in src/models/user.js.",
                    "files": [
                        "src/models/user.js"
                    ],
                    "estimated_hours": 1.0,
                    "complexity": "low",
                    "dependencies": [],
                    "blocking": true,
                    "validation": "Check that user model includes email and hashed password fields.",
                    "error_handling": [
                        "Handle missing fields in user model"
                    ],
                    "code_template": "const userSchema = new Schema({ email: String, password: String });"
                },
                {
                    "step": 2,
                    "title": "Implement Authentication Service",
                    "description": "Create authentication logic including password validation and JWT generation.",
                    "action": "Develop the authentication service in src/services/authService.js.",
                    "files": [
                        "src/services/authService.js"
                    ],
                    "estimated_hours": 2.0,
                    "complexity": "medium",
                    "dependencies": [
                        1
                    ],
                    "blocking": true,
                    "validation": "Unit tests for authentication service pass successfully.",
                    "error_handling": [
                        "Handle invalid credentials",
                        "Handle JWT generation errors"
                    ],
                    "code_template": "const jwt = require('jsonwebtoken'); function login(email, password) { ... }"
                },
                {
                    "step": 3,
                    "title": "Create Login Route",
                    "description": "Implement the user login API endpoint at /api/auth/login.",
                    "action": "Define the login route in src/routes/auth.js.",
                    "files": [
                        "src/routes/auth.js"
                    ],
                    "estimated_hours": 1.5,
                    "complexity": "medium",
                    "dependencies": [
                        2
                    ],
                    "blocking": true,
                    "validation": "Test the /api/auth/login endpoint with valid and invalid credentials.",
                    "error_handling": [
                        "Handle rate limiting",
                        "Log failed login attempts"
                    ],
                    "code_template": "router.post('/login', async (req, res) => { ... });"
                },
                {
                    "step": 4,
                    "title": "Update App Configuration",
                    "description": "Add the new login route to the Express app.",
                    "action": "Modify the main app file in src/app.js.",
                    "files": [
                        "src/app.js"
                    ],
                    "estimated_hours": 0.5,
                    "complexity": "low",
                    "dependencies": [
                        3
                    ],
                    "blocking": false,
                    "validation": "Ensure the login route is accessible via the API.",
                    "error_handling": [
                        "Handle route registration errors"
                    ],
                    "code_template": "app.use('/api/auth', authRoutes);"
                },
                {
                    "step": 5,
                    "title": "Write Unit Tests",
                    "description": "Create comprehensive unit tests for the login functionality.",
                    "action": "Add tests in src/tests/auth.test.js.",
                    "files": [
                        "src/tests/auth.test.js"
                    ],
                    "estimated_hours": 2.0,
                    "complexity": "medium",
                    "dependencies": [
                        4
                    ],
                    "blocking": false,
                    "validation": "Achieve 90%+ code coverage for authentication logic.",
                    "error_handling": [
                        "Handle test failures",
                        "Mock external dependencies"
                    ],
                    "code_template": "describe('POST /api/auth/login', () => { ... });"
                }
            ],
            "execution_order": [
                {
                    "step": 1,
                    "action": "Update data models",
                    "reason": "Services depend on updated models",
                    "blocking": true,
                    "depends_on": [],
                    "files": [
                        "src/models/user.js"
                    ]
                },
                {
                    "step": 2,
                    "action": "Implement service layer",
                    "reason": "Business logic implementation",
                    "blocking": true,
                    "depends_on": [
                        1
                    ],
                    "files": [
                        "src/services/authService.js"
                    ]
                }
            ],
            "parallel_opportunities": [],
            "subtasks": [
                {
                    "subtask_id": "SUB-001",
                    "title": "Update User Model",
                    "description": "Ensure the user model has necessary fields for email and hashed password.",
                    "estimated_hours": 1.0,
                    "priority": "high",
                    "dependencies": []
                },
                {
                    "subtask_id": "SUB-002",
                    "title": "Implement Authentication Service",
                    "description": "Create authentication logic including password validation and JWT generation.",
                    "estimated_hours": 2.0,
                    "priority": "high",
                    "dependencies": [
                        1
                    ]
                },
                {
                    "subtask_id": "SUB-003",
                    "title": "Create Login Route",
                    "description": "Implement the user login API endpoint at /api/auth/login.",
                    "estimated_hours": 1.5,
                    "priority": "high",
                    "dependencies": [
                        2
                    ]
                },
                {
                    "subtask_id": "SUB-004",
                    "title": "Update App Configuration",
                    "description": "Add the new login route to the Express app.",
                    "estimated_hours": 0.5,
                    "priority": "medium",
                    "dependencies": [
                        3
                    ]
                },
                {
                    "subtask_id": "SUB-005",
                    "title": "Write Unit Tests",
                    "description": "Create comprehensive unit tests for the login functionality.",
                    "estimated_hours": 2.0,
                    "priority": "medium",
                    "dependencies": [
                        4
                    ]
                }
            ],
            "execution_strategy": {
                "phases": [
                    {
                        "phase": 1,
                        "name": "Foundation",
                        "subtasks": [
                            "SUB-001",
                            "SUB-002"
                        ],
                        "blocking": true
                    },
                    {
                        "phase": 2,
                        "name": "Implementation",
                        "subtasks": [
                            "SUB-003",
                            "SUB-004"
                        ],
                        "blocking": true
                    },
                    {
                        "phase": 3,
                        "name": "Integration",
                        "subtasks": [
                            "SUB-005"
                        ],
                        "blocking": false
                    }
                ]
            }
        },
        "file_changes": {
            "files_to_create": [
                {
                    "path": "src/routes/auth.js",
                    "reason": "To implement the new user login API endpoint.",
                    "template": "Follow existing patterns in src/routes/auth.js for defining routes."
                },
                {
                    "path": "src/services/authService.js",
                    "reason": "To handle authentication logic including password validation and JWT generation.",
                    "template": "Use existing service patterns in src/services/authService.js."
                },
                {
                    "path": "src/tests/auth.test.js",
                    "reason": "To add comprehensive unit tests for the new login functionality.",
                    "template": "Follow existing test patterns in src/tests/auth.test.js."
                }
            ],
            "files_to_modify": [
                {
                    "path": "src/app.js",
                    "lines": [
                        67
                    ],
                    "changes": "Add the new login route to the Express app.",
                    "complexity": "low",
                    "risk": "low"
                },
                {
                    "path": "src/models/user.js",
                    "lines": [
                        3
                    ],
                    "changes": "Ensure the user model has necessary fields for email and hashed password.",
                    "complexity": "low",
                    "risk": "low"
                }
            ],
            "affected_modules": []
        },
        "infrastructure": {
            "database_changes": [],
            "api_endpoints": [],
            "external_dependencies": [],
            "internal_dependencies": []
        },
        "metadata": {
            "planner_version": "1.0",
            "planning_iterations": 3,
            "validation_passed": false,
            "created_by": "planner_subagent"
        }
    },
    "ready_for_implementation": true,
    "task_id": "TSK-2796",
    "complexity_score": 6,
    "estimated_hours": 7.0,
    "story_points": 5,
    "validation_score": 0.925,
    "status": "finalized",
    "iterations": 3,
    "metadata": {
        "planner_version": "1.0",
        "total_steps": 17,
        "thread_id": "test_session_planner_TASK-002"
    }
}